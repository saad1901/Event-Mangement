{% extends "base.html" %}
{% load static %}

{% block title %}Admin Dashboard{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/admin.css' %}">
{% endblock %}

{% block content %}
<div class="admin-dashboard">
    <!-- Dashboard Header -->
    <div class="dashboard-header">
        <h1>Admin Dashboard</h1>
        <div class="user-info">
            <span>Welcome, {{ current_user.name }}</span>
            <button class="logout-btn">Logout</button>
        </div>
    </div>

    <!-- Dashboard Stats -->
    <div class="stat-cards">
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-calendar-alt"></i>
            </div>
            <div class="stat-info">
                <h3>{{ stats.total_events }}</h3>
                <p>Total Events</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-users"></i>
            </div>
            <div class="stat-info">
                <h3>{{ stats.total_users }}</h3>
                <p>Registered Users</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-ticket-alt"></i>
            </div>
            <div class="stat-info">
                <h3>{{ stats.total_registrations }}</h3>
                <p>Event Registrations</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-dollar-sign"></i>
            </div>
            <div class="stat-info">
                <h3>${{ stats.revenue }}</h3>
                <p>Total Revenue</p>
            </div>
        </div>
    </div>

    <!-- Dashboard Main Content -->
    <div class="dashboard-main">
        <!-- Navigation Sidebar -->
        <div class="dashboard-nav">
            <ul>
                <li class="nav-item active" data-target="events-tab">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Events</span>
                </li>
                <li class="nav-item" data-target="users-tab">
                    <i class="fas fa-users"></i>
                    <span>Users</span>
                </li>
                <li class="nav-item" data-target="registrations-tab">
                    <i class="fas fa-ticket-alt"></i>
                    <span>Registrations</span>
                </li>
                <li class="nav-item" data-target="reports-tab">
                    <i class="fas fa-chart-bar"></i>
                    <span>Reports</span>
                </li>
                <li class="nav-item" data-target="settings-tab">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </li>
            </ul>
        </div>

        <!-- Dashboard Content Area -->
        <div class="dashboard-content">
            <!-- Events Tab -->
            <div id="events-tab" class="admin-tab active">
                <div class="tab-header">
                    <h2>Events Management</h2>
                    <div class="dashboard-actions">
                        <div class="search-box">
                            <input type="text" placeholder="Search events...">
                            <button><i class="fas fa-search"></i></button>
                        </div>
                        <div class="filter-options">
                            <select name="category">
                                <option value="">All Categories</option>
                                <option value="conference">Conference</option>
                                <option value="workshop">Workshop</option>
                                <option value="seminar">Seminar</option>
                                <option value="exhibition">Exhibition</option>
                                <option value="networking">Networking</option>
                            </select>
                            <select name="status">
                                <option value="">All Status</option>
                                <option value="upcoming">Upcoming</option>
                                <option value="ongoing">Ongoing</option>
                                <option value="completed">Completed</option>
                                <option value="cancelled">Cancelled</option>
                            </select>
                        </div>
                        <button class="primary-btn" data-modal-target="add-event-modal">
                            <i class="fas fa-plus"></i> Add New Event
                        </button>
                    </div>
                </div>
                
                <div class="data-table-container">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Event Name</th>
                                <th>Category</th>
                                <th>Date</th>
                                <th>Location</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for event in events %}
                            <tr>
                                <td>{{ event.id }}</td>
                                <td>{{ event.name }}</td>
                                <td data-category="{{ event.category }}">{{ event.category }}</td>
                                <td>{{ event.date }}</td>
                                <td>{{ event.location }}</td>
                                <td data-status="{{ event.status }}">
                                    <span class="badge badge-{{ event.status }}">{{ event.status }}</span>
                                </td>
                                <td class="action-buttons">
                                    <button class="view-btn" data-id="{{ event.id }}" data-type="event">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="edit-btn" data-id="{{ event.id }}" data-type="event" data-modal-target="add-event-modal">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="delete-btn" data-id="{{ event.id }}" data-type="event">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                
                <div class="pagination">
                    <button class="page-btn active">1</button>
                    <button class="page-btn">2</button>
                    <button class="page-btn">3</button>
                    <button class="page-btn">Next</button>
                </div>
            </div>

            <!-- Users Tab -->
            <div id="users-tab" class="admin-tab">
                <div class="tab-header">
                    <h2>Users Management</h2>
                    <div class="dashboard-actions">
                        <div class="search-box">
                            <input type="text" placeholder="Search users...">
                            <button><i class="fas fa-search"></i></button>
                        </div>
                        <div class="filter-options">
                            <select name="role">
                                <option value="">All Roles</option>
                                <option value="admin">Admin</option>
                                <option value="user">User</option>
                                <option value="organizer">Organizer</option>
                            </select>
                            <select name="status">
                                <option value="">All Status</option>
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                                <option value="suspended">Suspended</option>
                            </select>
                        </div>
                        <button class="primary-btn" data-modal-target="add-user-modal">
                            <i class="fas fa-plus"></i> Add New User
                        </button>
                    </div>
                </div>
                
                <div class="data-table-container">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Role</th>
                                <th>Registration Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for user in users %}
                            <tr>
                                <td>{{ user.id }}</td>
                                <td>{{ user.name }}</td>
                                <td>{{ user.email }}</td>
                                <td>{{ user.role }}</td>
                                <td>{{ user.registration_date }}</td>
                                <td>
                                    <span class="badge badge-{{ user.status }}">{{ user.status }}</span>
                                </td>
                                <td class="action-buttons">
                                    <button class="view-btn" data-id="{{ user.id }}" data-type="user">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="edit-btn" data-id="{{ user.id }}" data-type="user" data-modal-target="add-user-modal">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="delete-btn" data-id="{{ user.id }}" data-type="user">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                
                <div class="pagination">
                    <button class="page-btn active">1</button>
                    <button class="page-btn">2</button>
                    <button class="page-btn">Next</button>
                </div>
            </div>

            <!-- Registrations Tab -->
            <div id="registrations-tab" class="admin-tab">
                <div class="tab-header">
                    <h2>Event Registrations</h2>
                    <div class="dashboard-actions">
                        <div class="search-box">
                            <input type="text" placeholder="Search registrations...">
                            <button><i class="fas fa-search"></i></button>
                        </div>
                        <div class="filter-options">
                            <select name="event">
                                <option value="">All Events</option>
                                {% for event in events %}
                                <option value="{{ event.id }}">{{ event.name }}</option>
                                {% endfor %}
                            </select>
                            <select name="status">
                                <option value="">All Status</option>
                                <option value="confirmed">Confirmed</option>
                                <option value="pending">Pending</option>
                                <option value="cancelled">Cancelled</option>
                            </select>
                        </div>
                        <button class="primary-btn" data-modal-target="add-registration-modal">
                            <i class="fas fa-plus"></i> Add Registration
                        </button>
                    </div>
                </div>
                
                <div class="data-table-container">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Event</th>
                                <th>User</th>
                                <th>Ticket Type</th>
                                <th>Registration Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for registration in registrations %}
                            <tr>
                                <td>{{ registration.id }}</td>
                                <td>{{ registration.event_name }}</td>
                                <td>{{ registration.user_name }}</td>
                                <td>{{ registration.ticket_type }}</td>
                                <td>{{ registration.registration_date }}</td>
                                <td>
                                    <span class="badge badge-{{ registration.status }}">{{ registration.status }}</span>
                                </td>
                                <td class="action-buttons">
                                    <button class="view-btn" data-id="{{ registration.id }}" data-type="registration">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="edit-btn" data-id="{{ registration.id }}" data-type="registration" data-modal-target="add-registration-modal">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="delete-btn" data-id="{{ registration.id }}" data-type="registration">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                
                <div class="pagination">
                    <button class="page-btn active">1</button>
                    <button class="page-btn">2</button>
                    <button class="page-btn">3</button>
                    <button class="page-btn">Next</button>
                </div>
            </div>

            <!-- Reports Tab -->
            <div id="reports-tab" class="admin-tab">
                <div class="tab-header">
                    <h2>Analytics & Reports</h2>
                    <div class="dashboard-actions">
                        <div class="filter-options">
                            <select name="period">
                                <option value="last_6_months">Last 6 Months</option>
                                <option value="last_year">Last Year</option>
                                <option value="all_time">All Time</option>
                            </select>
                        </div>
                        <button class="secondary-btn">
                            <i class="fas fa-download"></i> Export Report
                        </button>
                    </div>
                </div>
                
                <div class="chart-grid">
                    <div class="chart-card">
                        <h3>Events Created</h3>
                        <div class="chart-container">
                            <canvas id="eventsChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-card">
                        <h3>Registrations</h3>
                        <div class="chart-container">
                            <canvas id="registrationsChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-card">
                        <h3>Events by Category</h3>
                        <div class="chart-container">
                            <canvas id="categoriesChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-card">
                        <h3>Key Metrics</h3>
                        <div class="metric-grid">
                            <div class="metric-item">
                                <h4>Average Attendance Rate</h4>
                                <p>85%</p>
                            </div>
                            <div class="metric-item">
                                <h4>Most Popular Category</h4>
                                <p>Workshops</p>
                            </div>
                            <div class="metric-item">
                                <h4>Revenue Growth</h4>
                                <p>+24% <span class="trend-up"><i class="fas fa-arrow-up"></i></span></p>
                            </div>
                            <div class="metric-item">
                                <h4>User Growth</h4>
                                <p>+18% <span class="trend-up"><i class="fas fa-arrow-up"></i></span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="settings-tab" class="admin-tab">
                <div class="tab-header">
                    <h2>System Settings</h2>
                </div>
                
                <div class="settings-container">
                    <div class="settings-card">
                        <h3>General Settings</h3>
                        <form class="admin-form" id="general-settings-form">
                            <div class="form-group">
                                <label for="site_name">Site Name</label>
                                <input type="text" id="site_name" name="site_name" value="Event Management App" required>
                            </div>
                            <div class="form-group">
                                <label for="contact_email">Contact Email</label>
                                <input type="email" id="contact_email" name="contact_email" value="contact@example.com" required>
                            </div>
                            <div class="form-group">
                                <label for="items_per_page">Items Per Page</label>
                                <select id="items_per_page" name="items_per_page">
                                    <option value="10">10</option>
                                    <option value="25" selected>25</option>
                                    <option value="50">50</option>
                                    <option value="100">100</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="timezone">Default Timezone</label>
                                <select id="timezone" name="timezone">
                                    <option value="UTC">UTC</option>
                                    <option value="America/New_York">Eastern Time</option>
                                    <option value="America/Chicago">Central Time</option>
                                    <option value="America/Denver">Mountain Time</option>
                                    <option value="America/Los_Angeles">Pacific Time</option>
                                </select>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="primary-btn">Save Changes</button>
                            </div>
                        </form>
                    </div>
                    
                    <div class="settings-card">
                        <h3>Email Settings</h3>
                        <form class="admin-form" id="email-settings-form">
                            <div class="form-group">
                                <label for="smtp_host">SMTP Host</label>
                                <input type="text" id="smtp_host" name="smtp_host" value="smtp.example.com">
                            </div>
                            <div class="form-group">
                                <label for="smtp_port">SMTP Port</label>
                                <input type="number" id="smtp_port" name="smtp_port" value="587">
                            </div>
                            <div class="form-group">
                                <label for="smtp_user">SMTP Username</label>
                                <input type="text" id="smtp_user" name="smtp_user" value="username">
                            </div>
                            <div class="form-group">
                                <label for="smtp_password">SMTP Password</label>
                                <input type="password" id="smtp_password" name="smtp_password" value="password">
                            </div>
                            <div class="form-group">
                                <label for="email_from">From Email</label>
                                <input type="email" id="email_from" name="email_from" value="noreply@example.com">
                            </div>
                            <div class="form-actions">
                                <button type="button" class="secondary-btn">Test Connection</button>
                                <button type="submit" class="primary-btn">Save Changes</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modals -->
<!-- Add/Edit Event Modal -->
<div id="add-event-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Add New Event</h2>
            <button class="close-modal">&times;</button>
        </div>
        <div class="modal-body">
            <form class="admin-form" id="event-form">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="name">Event Name</label>
                        <input type="text" id="name" name="name" placeholder="Enter event name" required>
                    </div>
                    <div class="form-group">
                        <label for="category">Category</label>
                        <select id="category" name="category" required>
                            <option value="">Select category</option>
                            <option value="Conference">Conference</option>
                            <option value="Workshop">Workshop</option>
                            <option value="Seminar">Seminar</option>
                            <option value="Exhibition">Exhibition</option>
                            <option value="Networking">Networking</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="date">Date</label>
                        <input type="date" id="date" name="date" required>
                    </div>
                    <div class="form-group">
                        <label for="time">Time</label>
                        <input type="time" id="time" name="time" required>
                    </div>
                    <div class="form-group">
                        <label for="location">Location</label>
                        <input type="text" id="location" name="location" placeholder="Enter location">
                    </div>
                    <div class="form-group">
                        <label for="price">Price</label>
                        <input type="number" id="price" name="price" step="0.01" min="0" placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label for="capacity">Capacity</label>
                        <input type="number" id="capacity" name="capacity" min="1" placeholder="Enter capacity">
                    </div>
                    <div class="form-group checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="featured" name="featured">
                            <span>Featured Event</span>
                        </label>
                    </div>
                </div>
                <div class="form-group full-width">
                    <label for="description">Description</label>
                    <textarea id="description" name="description" rows="5" placeholder="Enter event description"></textarea>
                </div>
                <div class="form-group full-width">
                    <label for="event_image">Event Image</label>
                    <input type="file" id="event_image" name="event_image" accept="image/*">
                    <div class="file-preview"></div>
                </div>
                <div class="form-actions">
                    <button type="button" class="secondary-btn close-modal">Cancel</button>
                    <button type="submit" class="primary-btn">Save Event</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Add/Edit User Modal -->
<div id="add-user-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Add New User</h2>
            <button class="close-modal">&times;</button>
        </div>
        <div class="modal-body">
            <form class="admin-form" id="user-form">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="user_name">Name</label>
                        <input type="text" id="user_name" name="name" placeholder="Enter user name" required>
                    </div>
                    <div class="form-group">
                        <label for="user_email">Email</label>
                        <input type="email" id="user_email" name="email" placeholder="Enter email address" required>
                    </div>
                    <div class="form-group">
                        <label for="user_password">Password</label>
                        <input type="password" id="user_password" name="password" placeholder="Enter password">
                        <small>Leave blank to keep current password when editing</small>
                    </div>
                    <div class="form-group">
                        <label for="user_role">Role</label>
                        <select id="user_role" name="role" required>
                            <option value="">Select role</option>
                            <option value="admin">Admin</option>
                            <option value="user">User</option>
                            <option value="organizer">Organizer</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="user_status">Status</label>
                        <select id="user_status" name="status" required>
                            <option value="">Select status</option>
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                            <option value="suspended">Suspended</option>
                        </select>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="secondary-btn close-modal">Cancel</button>
                    <button type="submit" class="primary-btn">Save User</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Add/Edit Registration Modal -->
<div id="add-registration-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Add New Registration</h2>
            <button class="close-modal">&times;</button>
        </div>
        <div class="modal-body">
            <form class="admin-form" id="registration-form">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="reg_event">Event</label>
                        <select id="reg_event" name="event_id" required>
                            <option value="">Select event</option>
                            {% for event in events %}
                            <option value="{{ event.id }}">{{ event.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="reg_user">User</label>
                        <select id="reg_user" name="user_id" required>
                            <option value="">Select user</option>
                            {% for user in users %}
                            <option value="{{ user.id }}">{{ user.name }} ({{ user.email }})</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="reg_ticket_type">Ticket Type</label>
                        <select id="reg_ticket_type" name="ticket_type" required>
                            <option value="">Select ticket type</option>
                            <option value="Standard">Standard</option>
                            <option value="VIP">VIP</option>
                            <option value="Early Bird">Early Bird</option>
                            <option value="Group">Group</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="reg_quantity">Quantity</label>
                        <input type="number" id="reg_quantity" name="quantity" min="1" value="1" required>
                    </div>
                    <div class="form-group">
                        <label for="reg_status">Status</label>
                        <select id="reg_status" name="status" required>
                            <option value="">Select status</option>
                            <option value="confirmed">Confirmed</option>
                            <option value="pending">Pending</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                    </div>
                </div>
                <div class="form-group full-width">
                    <label for="reg_notes">Notes</label>
                    <textarea id="reg_notes" name="notes" rows="3" placeholder="Add any notes about this registration"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="secondary-btn close-modal">Cancel</button>
                    <button type="submit" class="primary-btn">Save Registration</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{% static 'js/admin.js' %}"></script>
{% endblock %} 